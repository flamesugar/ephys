<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of TDT2mat</title>
  <meta name="keywords" content="TDT2mat">
  <meta name="description" content="TDT2MAT  TDT tank data extraction.">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">TDTfun</a> &gt; TDT2mat.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for TDTfun&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>TDT2mat
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>TDT2MAT  TDT tank data extraction.</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function data = TDT2mat(tank, block, varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment">TDT2MAT  TDT tank data extraction.
   blocks = TDT2mat(TANK)
   data = TDT2mat(TANK, BLOCK) 
   data = TDT2mat(TANK, BLOCK,'parameter',value,...) 
  
   If the TANK name is the only input then a list of blocks will be
   returned in a cell array.

   Where TANK and BLOCK are strings, retrieve all data from specified
   block in struct format.

   data.epocs      contains all epoc store data (onsets, offsets, values)
   data.snips      contains all snippet store data (timestamps, channels,
                   and raw data)
   data.streams    contains all continuous data (sampling rate and raw
                   data)
   data.info       contains some additional information about the block

   &quot;parameter&quot;, value pairs...
       &quot;T1&quot; is a scalar, retrieve data starting at T1 (0 for start at
           beginning of recording).
       &quot;T2&quot; is a scalar, retrieve data ending at T2 (0 for end at ending
           of recording).
       &quot;SORTNAME&quot; is the sorted spikes to be returned. (default is online
       sorted spikes).
       &quot;SILENT&quot; a summary of tank data will be
           returned if false (default).
       &quot;TYPE&quot; specifies to return all or subset of datatypes
                   ex: data = TDT2mat(&quot;MyTank&quot;,&quot;Block-1&quot;,&quot;TYPE&quot;,[1 2]);
                           &gt; returns epocs and snips data
           1   ...   all (default)
           2   ...   epocs
           3   ...   snips
           4   ...   streams

 Built by TDT, modified by DJS 5/2013</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="#_sub1" class="code">function CloseUp(TTX,TTXfig)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function data = TDT2mat(tank, block, varargin)</a>
0002 <span class="comment">%TDT2MAT  TDT tank data extraction.</span>
0003 <span class="comment">%   blocks = TDT2mat(TANK)</span>
0004 <span class="comment">%   data = TDT2mat(TANK, BLOCK)</span>
0005 <span class="comment">%   data = TDT2mat(TANK, BLOCK,'parameter',value,...)</span>
0006 <span class="comment">%</span>
0007 <span class="comment">%   If the TANK name is the only input then a list of blocks will be</span>
0008 <span class="comment">%   returned in a cell array.</span>
0009 <span class="comment">%</span>
0010 <span class="comment">%   Where TANK and BLOCK are strings, retrieve all data from specified</span>
0011 <span class="comment">%   block in struct format.</span>
0012 <span class="comment">%</span>
0013 <span class="comment">%   data.epocs      contains all epoc store data (onsets, offsets, values)</span>
0014 <span class="comment">%   data.snips      contains all snippet store data (timestamps, channels,</span>
0015 <span class="comment">%                   and raw data)</span>
0016 <span class="comment">%   data.streams    contains all continuous data (sampling rate and raw</span>
0017 <span class="comment">%                   data)</span>
0018 <span class="comment">%   data.info       contains some additional information about the block</span>
0019 <span class="comment">%</span>
0020 <span class="comment">%   &quot;parameter&quot;, value pairs...</span>
0021 <span class="comment">%       &quot;T1&quot; is a scalar, retrieve data starting at T1 (0 for start at</span>
0022 <span class="comment">%           beginning of recording).</span>
0023 <span class="comment">%       &quot;T2&quot; is a scalar, retrieve data ending at T2 (0 for end at ending</span>
0024 <span class="comment">%           of recording).</span>
0025 <span class="comment">%       &quot;SORTNAME&quot; is the sorted spikes to be returned. (default is online</span>
0026 <span class="comment">%       sorted spikes).</span>
0027 <span class="comment">%       &quot;SILENT&quot; a summary of tank data will be</span>
0028 <span class="comment">%           returned if false (default).</span>
0029 <span class="comment">%       &quot;TYPE&quot; specifies to return all or subset of datatypes</span>
0030 <span class="comment">%                   ex: data = TDT2mat(&quot;MyTank&quot;,&quot;Block-1&quot;,&quot;TYPE&quot;,[1 2]);</span>
0031 <span class="comment">%                           &gt; returns epocs and snips data</span>
0032 <span class="comment">%           1   ...   all (default)</span>
0033 <span class="comment">%           2   ...   epocs</span>
0034 <span class="comment">%           3   ...   snips</span>
0035 <span class="comment">%           4   ...   streams</span>
0036 <span class="comment">%</span>
0037 <span class="comment">% Built by TDT, modified by DJS 5/2013</span>
0038 
0039 data = struct(<span class="string">'epocs'</span>,[],<span class="string">'snips'</span>,[],<span class="string">'streams'</span>,[],<span class="string">'info'</span>,[]);
0040 
0041 <span class="comment">% defaults</span>
0042 T1       = 0;
0043 T2       = 0;
0044 SILENT   = 0;
0045 TYPE     = 1;
0046 SORTNAME = <span class="string">'TankSort'</span>;
0047 
0048 <span class="comment">% parse varargin</span>
0049 <span class="keyword">for</span> i = 1:2:length(varargin)
0050     eval([upper(varargin{i}) <span class="string">'=varargin{i+1};'</span>]);
0051 <span class="keyword">end</span>
0052 
0053 <span class="keyword">if</span> TYPE == 1, TYPE = 1:4; <span class="keyword">end</span>
0054 
0055 TTXfig = figure(<span class="string">'Visible'</span>,<span class="string">'off'</span>,<span class="string">'HandleVisibility'</span>,<span class="string">'off'</span>);
0056 TTX = actxcontrol(<span class="string">'TTank.X'</span>,<span class="string">'Parent'</span>,TTXfig);
0057 
0058 server = <span class="string">'Local'</span>;
0059 <span class="keyword">if</span> TTX.ConnectServer(server, <span class="string">'Me'</span>) ~= 1
0060     error([<span class="string">'Problem connecting to Tank server: '</span> server])
0061 <span class="keyword">end</span>
0062 
0063 <span class="keyword">if</span> TTX.OpenTank(tank, <span class="string">'R'</span>) ~= 1
0064     <a href="#_sub1" class="code" title="subfunction CloseUp(TTX,TTXfig)">CloseUp</a>(TTX,TTXfig);
0065     error([<span class="string">'Problem opening tank: '</span> tank]);
0066 <span class="keyword">end</span>
0067 
0068 blocks{1} = TTX.QueryBlockName(0);
0069 i = 1;
0070 <span class="keyword">while</span> strcmp(blocks{i}, <span class="string">''</span>) == 0
0071     i = i+1;
0072     blocks{i} = TTX.QueryBlockName(i); <span class="comment">%#ok&lt;AGROW&gt;</span>
0073 <span class="keyword">end</span>
0074 blocks(end) = [];
0075 
0076 <span class="keyword">if</span> nargin == 1 || isempty(block)
0077     data = blocks;
0078     <span class="keyword">return</span>
0079 <span class="keyword">end</span>
0080 
0081 <span class="keyword">if</span> TTX.SelectBlock([<span class="string">'~'</span> block]) ~= 1
0082     <a href="#_sub1" class="code" title="subfunction CloseUp(TTX,TTXfig)">CloseUp</a>(TTX,TTXfig);
0083     <span class="keyword">if</span> ~ismember(block, blocks)
0084         error([<span class="string">'Block found, but problem selecting it: '</span> block]);
0085     <span class="keyword">end</span>
0086     error([<span class="string">'Block not found: '</span> block]);
0087 <span class="keyword">end</span>
0088 
0089 TTX.SetGlobalV(<span class="string">'WavesMemLimit'</span>,1e9);
0090 TTX.SetGlobalV(<span class="string">'MaxReturn'</span>,1e7);
0091 TTX.SetGlobalV(<span class="string">'T1'</span>, T1);
0092 TTX.SetGlobalV(<span class="string">'T2'</span>, T2);
0093 
0094 lStores = TTX.GetEventCodes(0);
0095 <span class="keyword">for</span> i = 1:length(lStores)
0096     name = TTX.CodeToString(lStores(i));
0097     <span class="keyword">if</span> ~SILENT, fprintf(<span class="string">'Store Name:\t%s\n'</span>, name); <span class="keyword">end</span>
0098     
0099     TTX.GetCodeSpecs(lStores(i));
0100     type = TTX.EvTypeToString(TTX.EvType);
0101     <span class="keyword">if</span> ~SILENT, fprintf(<span class="string">'\t&gt;EvType:     \t%s\n'</span>, type); <span class="keyword">end</span>
0102     
0103     <span class="keyword">if</span> bitand(TTX.EvType, 33025) == 33025 <span class="comment">% catch RS4 header (33073)</span>
0104         type = <span class="string">'Stream'</span>;
0105     <span class="keyword">end</span>
0106     
0107     <span class="keyword">switch</span> type
0108         <span class="keyword">case</span> <span class="string">'Strobe+'</span>
0109             <span class="keyword">if</span> ~any(TYPE==2), <span class="keyword">continue</span>; <span class="keyword">end</span>
0110             d = TTX.GetEpocsV(name, T1, T2, 1e6)';
0111             data.epocs.(name).data  = d(:,1);
0112             data.epocs.(name).onset = d(:,2);
0113             <span class="keyword">if</span> d(:,3) == zeros(size(d(:,3)))
0114                 d(:,3) = [d(2:<span class="keyword">end</span>,2); inf];
0115             <span class="keyword">end</span>
0116             data.epocs.(name).offset = d(:,2);
0117             
0118         <span class="keyword">case</span> <span class="string">'Scalar'</span>
0119             <span class="keyword">if</span> ~any(TYPE==2), <span class="keyword">continue</span>; <span class="keyword">end</span>
0120             N = TTX.ReadEventsSimple(name);
0121             data.epocs.(name).data  = TTX.ParseEvV(0, N);
0122             data.epocs.(name).onset = TTX.ParseEvInfoV(0, N, 6);
0123             
0124         <span class="keyword">case</span> <span class="string">'Stream'</span>
0125             <span class="keyword">if</span> any(TYPE==4)
0126                 TTX.ReadEventsV(0, name, 0, 0, 0, 0, <span class="string">'ALL'</span>);
0127                 data.streams.(name).data = TTX.ReadWavesV(name);
0128                 num_channels = size(data.streams.(name).data,2);
0129             <span class="keyword">else</span>
0130                 TTX.SetGlobalV(<span class="string">'T1'</span>, 0);
0131                 TTX.SetGlobalV(<span class="string">'T2'</span>, 5);
0132                 TTX.ReadEventsV(2^9, name, 0, 0, 0, 5, <span class="string">'ALL'</span>);
0133                 t = TTX.ReadWavesV(name);
0134                 TTX.SetGlobalV(<span class="string">'T1'</span>, T1);
0135                 TTX.SetGlobalV(<span class="string">'T2'</span>, T2);
0136                 num_channels = size(t,2);
0137             <span class="keyword">end</span>
0138             <span class="keyword">if</span> ~SILENT, fprintf(<span class="string">'\t&gt;N channels: \t%d\n'</span>, num_channels);  <span class="keyword">end</span>
0139             data.streams.(name).chan = 1:num_channels;
0140             data.streams.(name).fs = TTX.EvSampFreq;
0141             <span class="keyword">if</span> ~SILENT, fprintf(<span class="string">'\t&gt;Data Size:  \t%d\n'</span>,TTX.EvDataSize); <span class="keyword">end</span>
0142             <span class="keyword">if</span> ~SILENT, fprintf(<span class="string">'\t&gt;Samp Rate:  \t%f\n'</span>,TTX.EvSampFreq); <span class="keyword">end</span>
0143             
0144         <span class="keyword">case</span> <span class="string">'Snip'</span>
0145             <span class="keyword">if</span> any(TYPE==3)
0146                 data.snips.(name) = struct(<span class="string">'data'</span>,[],<span class="string">'chan'</span>,[],<span class="string">'sort'</span>,[],<span class="string">'ts'</span>,[],<span class="string">'index'</span>,[]);
0147                 TTX.SetUseSortName(SORTNAME);
0148                 N = TTX.ReadEventsV(1e7, name, 0, 0, 0.0, 0.0, <span class="string">'ALL'</span>);
0149                 <span class="keyword">if</span> N == 0, <span class="keyword">continue</span>; <span class="keyword">end</span>
0150                 data.snips.(name).data(end+1:end+N,:) = TTX.ParseEvV(0, N)';
0151                 data.snips.(name).chan(end+1:end+N)   = TTX.ParseEvInfoV(0, N, 4);
0152                 data.snips.(name).sort(end+1:end+N)   = TTX.ParseEvInfoV(0, N, 5);
0153                 data.snips.(name).ts(end+1:end+N)     = TTX.ParseEvInfoV(0, N, 6);
0154                 N = TTX.ReadEventsV(N,name,0,0,0,0,<span class="string">'IDXPSQ'</span>);
0155                 data.snips.(name).index(end+1:end+N)  = TTX.GetEvTsqIdx;
0156                 data.snips.(name).sortname = SORTNAME;
0157             <span class="keyword">else</span>
0158                 TTX.ReadEventsV(2^9, name, 0, 0, 0, 0, <span class="string">'ALL'</span>);
0159             <span class="keyword">end</span>
0160             s = 1;
0161             <span class="keyword">while</span> 1
0162                 sorts{s} = TTX.GetSortName(name, s); <span class="comment">%#ok&lt;AGROW&gt;</span>
0163                 <span class="keyword">if</span> isempty(sorts{s}), sorts{s} = <span class="string">'TankSort'</span>; <span class="keyword">break</span>; <span class="keyword">end</span> <span class="comment">%#ok&lt;AGROW&gt;</span>
0164                 s = s + 1;
0165             <span class="keyword">end</span>
0166             data.snips.(name).sorts = sorts;
0167             data.snips.(name).fs = TTX.EvSampFreq;
0168             <span class="keyword">if</span> ~SILENT, fprintf(<span class="string">'\t&gt;Sort ID:    \t%s\n'</span>,SORTNAME);         <span class="keyword">end</span>
0169             <span class="keyword">if</span> ~SILENT, fprintf(<span class="string">'\t&gt;Data Size:  \t%d\n'</span>,TTX.EvDataSize); <span class="keyword">end</span>
0170             <span class="keyword">if</span> ~SILENT, fprintf(<span class="string">'\t&gt;Samp Rate:  \t%f\n'</span>,TTX.EvSampFreq); <span class="keyword">end</span>
0171             
0172     <span class="keyword">end</span>
0173     <span class="keyword">if</span> ~SILENT, disp(<span class="string">' '</span>); <span class="keyword">end</span>
0174 <span class="keyword">end</span>
0175 
0176 <span class="comment">% get general block info</span>
0177 t1                  = TTX.CurBlockStartTime;
0178 data.info.date      = TTX.FancyTime(t1,<span class="string">'Y-O-D'</span>);
0179 data.info.begintime = TTX.FancyTime(t1,<span class="string">'H:M:S'</span>);
0180 t2                  = TTX.CurBlockStopTime;
0181 data.info.endtime   = TTX.FancyTime(t2,   <span class="string">'H:M:S'</span>);
0182 data.info.duration  = TTX.FancyTime(t2-t1,<span class="string">'H:M:S'</span>);
0183 data.info.blockname = block;
0184 
0185 data = orderfields(data);
0186 
0187 <a href="#_sub1" class="code" title="subfunction CloseUp(TTX,TTXfig)">CloseUp</a>(TTX,TTXfig)
0188 
0189 
0190 
0191 
0192 <a name="_sub1" href="#_subfunctions" class="code">function CloseUp(TTX,TTXfig)</a>
0193 TTX.CloseTank;
0194 TTX.ReleaseServer;
0195 close(TTXfig);
0196</pre></div>
<hr><address>Generated on Thu 11-Jul-2013 10:16:49 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>