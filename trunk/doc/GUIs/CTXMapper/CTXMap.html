<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of CTXMap</title>
  <meta name="keywords" content="CTXMap">
  <meta name="description" content="">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="#">GUIs</a> &gt; <a href="index.html">CTXMapper</a> &gt; CTXMap.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for GUIs\CTXMapper&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>CTXMap
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong></strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>This is a script file. </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="CTXMap.html" class="code" title="">CTXMap</a>	</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="CTXMap.html" class="code" title="">CTXMap</a>	</li><li><a href="CTXMapper.html" class="code" title="function varargout = CTXMapper(varargin)">CTXMapper</a>	CTXMAPPER MATLAB code for CTXMapper.fig</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function h = get.CTXImageAxes(obj)</a></li><li><a href="#_sub2" class="code">function obj = loadCTXImage(obj,fpath)</a></li><li><a href="#_sub3" class="code">function addPoints(obj,p)</a></li><li><a href="#_sub4" class="code">function remPoints(obj,ind)</a></li><li><a href="#_sub5" class="code">function dispCTXImage(obj)</a></li><li><a href="#_sub6" class="code">function plotPoints(obj)</a></li><li><a href="#_sub7" class="code">function plotVoronoi(obj)</a></li><li><a href="#_sub8" class="code">function updatePlots(obj)</a></li><li><a href="#_sub9" class="code">function CTXclick(hObj,~,obj,id)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 classdef <a href="CTXMap.html" class="code" title="">CTXMap</a> &lt; handle
0002     properties
0003         CTXImage
0004         CTXImageInfo
0005         CTXImageAxes
0006         CTXFilePath
0007         TessellData
0008         Scale
0009         Points
0010         PlotType = <span class="string">'Points'</span>;
0011     <span class="keyword">end</span>
0012     
0013     methods
0014         
0015         <a name="_sub0" href="#_subfunctions" class="code">function h = get.CTXImageAxes(obj)</a>
0016             <span class="keyword">if</span> ~ishandle(obj.CTXImageAxes)
0017                 obj.CTXImageAxes = [];
0018             <span class="keyword">end</span>
0019             h = obj.CTXImageAxes;
0020         <span class="keyword">end</span>
0021         
0022         <a name="_sub1" href="#_subfunctions" class="code">function obj = loadCTXImage(obj,fpath)</a>
0023             <span class="keyword">if</span> ~exist(<span class="string">'fpath'</span>,<span class="string">'var'</span>) || isempty(fpath) || ~exist(<span class="string">'fpath'</span>,<span class="string">'file'</span>)
0024                 [f,p] = uigetfile({<span class="string">'*.jpg'</span>,<span class="string">'JPG Image File'</span>},<span class="string">'Locate Image'</span>);
0025                 <span class="keyword">if</span> ~f, <span class="keyword">return</span>; <span class="keyword">end</span>
0026                 fpath = fullfile(p,f);
0027             <span class="keyword">end</span>
0028             obj.CTXFilePath  = fpath;
0029             obj.CTXImageInfo = imfinfo(fpath);
0030             obj.CTXImage     = imread(fpath);
0031         <span class="keyword">end</span>
0032         
0033         <a name="_sub2" href="#_subfunctions" class="code">function addPoints(obj,p)</a>
0034             <span class="keyword">if</span> size(p,2) ~= 3
0035                 error(<span class="string">'Points property must be Nx3 matrix'</span>)
0036             <span class="keyword">end</span>
0037             obj.Points = [obj.Points; p];
0038         <span class="keyword">end</span>
0039         
0040         <a name="_sub3" href="#_subfunctions" class="code">function remPoints(obj,ind)</a>
0041             <span class="keyword">if</span> ~exist(<span class="string">'ind'</span>,<span class="string">'var'</span>) || isempty(ind)
0042                 r = questdlg(<span class="string">'This action will remove ALL points. Continue?'</span>, <span class="keyword">...</span>
0043                     <span class="string">'Remove All Points'</span>,<span class="string">'Yes'</span>,<span class="string">'No'</span>,<span class="string">'No'</span>);
0044                 <span class="keyword">if</span> strcmp(r,<span class="string">'No'</span>), <span class="keyword">return</span>; <span class="keyword">end</span>
0045                 ind = true(1,size(obj.Points,2));
0046             <span class="keyword">end</span>
0047             obj.Points(ind,:) = [];
0048             obj.updatePlots;
0049         <span class="keyword">end</span>
0050         
0051         <a name="_sub4" href="#_subfunctions" class="code">function dispCTXImage(obj)</a>
0052             <span class="keyword">if</span> isempty(obj.CTXImage), error(<span class="string">'No CTXImage specified'</span>); <span class="keyword">end</span>
0053             <span class="keyword">if</span> isempty(obj.CTXImageAxes), error(<span class="string">'CTXImageAxes not available'</span>); <span class="keyword">end</span>
0054             ax = obj.CTXImageAxes;
0055             cla(ax);
0056             c = obj.CTXImage;
0057             <span class="keyword">if</span> ~isempty(c)
0058                 s = size(c);
0059                 c = reshape(c,s(1),s(2)*s(3));
0060                 c = flipud(c);
0061                 c = reshape(c,s);
0062                 image(c,<span class="string">'Parent'</span>,ax, <span class="keyword">...</span>
0063                     <span class="string">'ButtonDownFcn'</span>,{<span class="string">'CTXMap.CTXclick'</span>,obj}, <span class="keyword">...</span>
0064                     <span class="string">'Tag'</span>,<span class="string">'CTXImage'</span>);
0065                 set(ax,<span class="string">'ydir'</span>,<span class="string">'normal'</span>);
0066                 grid(ax,<span class="string">'on'</span>);
0067                 
0068             <span class="keyword">end</span>
0069         <span class="keyword">end</span>
0070         
0071         <a name="_sub5" href="#_subfunctions" class="code">function plotPoints(obj)</a>
0072             ax = obj.CTXImageAxes;
0073             <span class="keyword">if</span> ~exist(<span class="string">'ax'</span>,<span class="string">'var'</span>) || isempty(ax), ax = gca; <span class="keyword">end</span>
0074             
0075             delete(findobj(<span class="string">'tag'</span>,<span class="string">'CTXPoints'</span>));
0076             
0077             x = obj.Points(:,1);
0078             y = obj.Points(:,2);
0079             z = obj.Points(:,3);
0080             
0081             [~,cvec] = hist(z(z&gt;0),10);
0082             cm = jet(10);
0083             
0084             hold(ax,<span class="string">'on'</span>);
0085             <span class="keyword">for</span> i = 1:length(x)
0086                 <span class="keyword">if</span> z(i) == 0 <span class="comment">% no response</span>
0087                     h(i) = plot(ax,x(i),y(i),<span class="string">'ok'</span>, <span class="keyword">...</span>
0088                         <span class="string">'MarkerSize'</span>,4,<span class="string">'MarkerFaceColor'</span>,<span class="string">'k'</span>, <span class="keyword">...</span>
0089                         <span class="string">'ButtonDownFcn'</span>,{<span class="string">'CTXMap.CTXclick'</span>,obj,i});
0090                 <span class="keyword">elseif</span> z(i) == -1 <span class="comment">% NB response only</span>
0091                     h(i) = plot(ax,x(i),y(i),<span class="string">'ok'</span>, <span class="keyword">...</span>
0092                         <span class="string">'MarkerSize'</span>,4,<span class="string">'MarkerFaceColor'</span>,<span class="string">'none'</span>, <span class="keyword">...</span>
0093                         <span class="string">'ButtonDownFcn'</span>,{<span class="string">'CTXMap.CTXclick'</span>,obj,i});
0094                 <span class="keyword">else</span> <span class="comment">% tone response</span>
0095                     cind = nearest(cvec,z(i));
0096                     h(i) = plot(ax,x(i),y(i),<span class="string">'o'</span>, <span class="keyword">...</span>
0097                         <span class="string">'MarkerSize'</span>,4,<span class="string">'MarkerFaceColor'</span>,cm(cind,:), <span class="keyword">...</span>
0098                         <span class="string">'Color'</span>,cm(cind,:), <span class="keyword">...</span>
0099                         <span class="string">'ButtonDownFcn'</span>,{<span class="string">'CTXMap.CTXclick'</span>,obj,i});
0100                 <span class="keyword">end</span>
0101             <span class="keyword">end</span>
0102             hold(ax,<span class="string">'off'</span>);
0103             set(h,<span class="string">'tag'</span>,<span class="string">'CTXPoints'</span>);
0104         <span class="keyword">end</span>
0105         
0106         
0107         
0108         <a name="_sub6" href="#_subfunctions" class="code">function plotVoronoi(obj)</a>
0109             <span class="keyword">if</span> isempty(obj.CTXImageAxes), error(<span class="string">'CTXImageAxes not available'</span>); <span class="keyword">end</span>
0110             ax = obj.CTXImageAxes;
0111             
0112             <span class="keyword">if</span> isempty(obj.Points), <span class="keyword">return</span>; <span class="keyword">end</span>
0113             
0114             delete(findobj(<span class="string">'tag'</span>,<span class="string">'CTXvoronoi'</span>));
0115             
0116             x = obj.Points(:,1);
0117             y = obj.Points(:,2);
0118             z = obj.Points(:,3);
0119                        
0120             <span class="keyword">if</span> length(x) &lt; 3, <span class="keyword">return</span>; <span class="keyword">end</span>
0121             
0122             hold(ax,<span class="string">'on'</span>);
0123             [~,cvec] = hist(z,10);
0124             cm = jet(10);
0125             [c,v] = voronoin([x y]);
0126             <span class="keyword">for</span> i = 1:length(v)
0127                 nx = c(v{i},:);
0128                 cind = nearest(cvec,z(i));
0129                 patch(nx(:,1),nx(:,2),cm(cind,:),<span class="string">'parent'</span>,ax,<span class="string">'tag'</span>,<span class="string">'CTXvoronoi'</span>);
0130             <span class="keyword">end</span>
0131             k = convhull(x,y);
0132             plot(ax,x(k),y(k));
0133             hold(ax,<span class="string">'off'</span>);
0134             
0135             <span class="comment">%             [C,V] = voronoin([x y]);</span>
0136             <span class="comment">%             hold(ax,'on');</span>
0137             <span class="comment">%             for i = 1:length(V)</span>
0138             <span class="comment">%                 nx = C(V{i},:);</span>
0139             <span class="comment">%                 nx(isinf(nx(:,1)),:) = [];</span>
0140             <span class="comment">%                 if size(nx,1) &lt; 3, continue; end</span>
0141             <span class="comment">%                 tri = convhulln(nx);</span>
0142             <span class="comment">%                 for j = 1:size(tri,1)</span>
0143             <span class="comment">%                     patch(nx(tri(j,:),1),nx(tri(j,:),2),rand,'parent',ax);</span>
0144             <span class="comment">%                 end</span>
0145             <span class="comment">%             end</span>
0146             <span class="comment">%             hold(ax,'off');</span>
0147             
0148             <span class="comment">%             TRI = delaunay(x,y);</span>
0149             <span class="comment">%             hold(ax,'on');</span>
0150             <span class="comment">%             t = trisurf(TRI,x,y,zeros(size(x)),'Parent',ax);</span>
0151             <span class="comment">%             hold(ax,'off');</span>
0152             <span class="comment">%             view(ax,2);</span>
0153             <span class="comment">%             set(t,'FaceVertexCData',z,'FaceAlpha',0.6, ...</span>
0154             <span class="comment">%                 'LineStyle','none');</span>
0155             
0156             hold(ax,<span class="string">'on'</span>);
0157             plot(ax,x,y,<span class="string">'ok'</span>,<span class="string">'MarkerSize'</span>,2,<span class="string">'MarkerFaceColor'</span>,<span class="string">'k'</span>);
0158             hold(ax,<span class="string">'off'</span>);
0159             
0160             set(ax,<span class="string">'xlim'</span>,xlim(obj.CTXImageAxes), <span class="keyword">...</span>
0161                 <span class="string">'ylim'</span>,ylim(obj.CTXImageAxes), <span class="keyword">...</span>
0162                 <span class="string">'box'</span>,<span class="string">'on'</span>);
0163             grid(ax,<span class="string">'on'</span>);
0164         <span class="keyword">end</span>
0165         
0166         <a name="_sub7" href="#_subfunctions" class="code">function updatePlots(obj)</a>
0167             <span class="comment">%             notify(obj,'updateCTXPlots');</span>
0168             cla(obj.CTXImageAxes);
0169             obj.dispCTXImage;
0170             <span class="keyword">if</span> ~strcmp(obj.PlotType,<span class="string">'None'</span>)
0171                 eval(sprintf(<span class="string">'obj.plot%s'</span>,obj.PlotType));
0172             <span class="keyword">end</span>
0173         <span class="keyword">end</span>
0174         
0175     <span class="keyword">end</span>
0176     
0177     methods(Static)
0178         <a name="_sub8" href="#_subfunctions" class="code">function CTXclick(hObj,~,obj,id)</a>
0179             ax = get(hObj,<span class="string">'Parent'</span>);
0180             cp = get(ax,<span class="string">'CurrentPoint'</span>);
0181             
0182             p = ancestor(hObj,<span class="string">'figure'</span>);
0183             
0184             button = get(p, <span class="string">'SelectionType'</span>);
0185             <span class="keyword">if</span> strcmp(button,<span class="string">'normal'</span>) <span class="comment">% left click</span>
0186                 <span class="comment">% add point (No Response (NR) = 0; No Tone Response (NTR) = -1</span>
0187                 v = inputdlg(<span class="string">'Enter value (0 for ''NR''; -1 for ''NTR:'</span>);
0188                 <span class="keyword">if</span> isempty(v), <span class="keyword">return</span>; <span class="keyword">end</span>
0189                 v = str2num(v{1}); <span class="comment">%#ok&lt;ST2NM&gt;</span>
0190                 obj.addPoints([cp(1,1) cp(1,2) v]);
0191                 
0192                 
0193             <span class="keyword">elseif</span> strcmp(button,<span class="string">'extend'</span>) <span class="comment">% shift click</span>
0194                 <span class="comment">% remove selected point</span>
0195                 <span class="keyword">if</span> ~exist(<span class="string">'id'</span>,<span class="string">'var'</span>) || isempty(id), <span class="keyword">return</span>; <span class="keyword">end</span>
0196                 obj.remPoints(id);
0197                 
0198             <span class="keyword">elseif</span> strcmp(button,<span class="string">'alt'</span>) <span class="comment">% right click</span>
0199                 pt = {<span class="string">'None'</span>,<span class="string">'Voronoi'</span>,<span class="string">'Points'</span>};
0200                 [s,ok] = listdlg( <span class="keyword">...</span>
0201                     <span class="string">'ListString'</span>,pt, <span class="keyword">...</span>
0202                     <span class="string">'SelectionMode'</span>,<span class="string">'Single'</span>,<span class="string">'Name'</span>,<span class="string">'Plot Type'</span>, <span class="keyword">...</span>
0203                     <span class="string">'InitialValue'</span>,obj.PlotType, <span class="keyword">...</span>
0204                     <span class="string">'PromptString'</span>,<span class="string">'Select plot type:'</span>);
0205                 <span class="keyword">if</span> ok, obj.PlotType = pt{s}; <span class="keyword">end</span>
0206                 
0207             <span class="keyword">end</span>
0208             
0209             obj.updatePlots;
0210             
0211         <span class="keyword">end</span>
0212     <span class="keyword">end</span>
0213     
0214     events
0215         updateCTXPlots
0216     <span class="keyword">end</span>
0217     
0218 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Wed 24-Jul-2013 19:48:12 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>