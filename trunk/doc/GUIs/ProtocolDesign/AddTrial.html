<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of AddTrial</title>
  <meta name="keywords" content="AddTrial">
  <meta name="description" content="[schedule,fail] = AddTrial(schedule,varargin)">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="#">GUIs</a> &gt; <a href="index.html">ProtocolDesign</a> &gt; AddTrial.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for GUIs\ProtocolDesign&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>AddTrial
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>[schedule,fail] = AddTrial(schedule,varargin)</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function [schedule,fail] = AddTrial(schedule,varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> [schedule,fail] = AddTrial(schedule,varargin)
 
 INPUTS: schedule should be empty or the returned structure from a
 previous call to this function.
         varargin inputs can be specified as follows:
 
       Define stimuli to use in schedule:
  schedule = AddTrial(schedule,[100 200 400 800]);

       Two variables can be made to covary:
  schedule = AddTrial(schedule,'buddy','commonname',[1 2 4  90 2])
  schedule = AddTrial(schedule,'buddy','commonname',[2 4 8 180 4])
               - all buddy parameters must be the same length.
 
       To randomize input between some range:
  schedule = AddTrial(schedule,'randomized','round',[100 400]);
               - the second input can be the function name to operate on
               randomized value between the range specified in the next
               parameter.  If no function should be applied to the random
               numbers, then simply leave empty: ...'randomized',[],[100 400])
               - most often, this will be the last call to this funciton
               in a series of calls.  Otherwise, random numbers will be
               repeated.
 
       Note: to facilitate creation of trials, varargin can also be a
       single cell containing intended varargin values.  Ex:
 
  vin{1} = {[100 200 400 800]};
  vin{2} = {'randomized','round',[100 400]};
  schedule = AddTrial(schedule,vin);
 
 OUTPUT: schedule structure with the following fields
           trials  ...  unique trials (as cell matrix)
           buds    ...  'buddy' parameters
 
      If all data is numeric, then schedule.trials =
      CELL2MAT(schedule.trials) can be used.
 
       fail ... true if there was an error during operation, false if all
                   is good
 DJS (c) 2010</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="CompileProtocol.html" class="code" title="function [P,fail] = CompileProtocol(P)">CompileProtocol</a>	[P,fail] = CompileProtocol(P)</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function [schedule,fail] = BAT(schedule,varargin)</a></li><li><a href="#_sub2" class="code">function [trials,fail] = combinetrials(trials,newtrials,expand)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [schedule,fail] = AddTrial(schedule,varargin)</a>
0002 <span class="comment">% [schedule,fail] = AddTrial(schedule,varargin)</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% INPUTS: schedule should be empty or the returned structure from a</span>
0005 <span class="comment">% previous call to this function.</span>
0006 <span class="comment">%         varargin inputs can be specified as follows:</span>
0007 <span class="comment">%</span>
0008 <span class="comment">%       Define stimuli to use in schedule:</span>
0009 <span class="comment">%  schedule = AddTrial(schedule,[100 200 400 800]);</span>
0010 <span class="comment">%</span>
0011 <span class="comment">%       Two variables can be made to covary:</span>
0012 <span class="comment">%  schedule = AddTrial(schedule,'buddy','commonname',[1 2 4  90 2])</span>
0013 <span class="comment">%  schedule = AddTrial(schedule,'buddy','commonname',[2 4 8 180 4])</span>
0014 <span class="comment">%               - all buddy parameters must be the same length.</span>
0015 <span class="comment">%</span>
0016 <span class="comment">%       To randomize input between some range:</span>
0017 <span class="comment">%  schedule = AddTrial(schedule,'randomized','round',[100 400]);</span>
0018 <span class="comment">%               - the second input can be the function name to operate on</span>
0019 <span class="comment">%               randomized value between the range specified in the next</span>
0020 <span class="comment">%               parameter.  If no function should be applied to the random</span>
0021 <span class="comment">%               numbers, then simply leave empty: ...'randomized',[],[100 400])</span>
0022 <span class="comment">%               - most often, this will be the last call to this funciton</span>
0023 <span class="comment">%               in a series of calls.  Otherwise, random numbers will be</span>
0024 <span class="comment">%               repeated.</span>
0025 <span class="comment">%</span>
0026 <span class="comment">%       Note: to facilitate creation of trials, varargin can also be a</span>
0027 <span class="comment">%       single cell containing intended varargin values.  Ex:</span>
0028 <span class="comment">%</span>
0029 <span class="comment">%  vin{1} = {[100 200 400 800]};</span>
0030 <span class="comment">%  vin{2} = {'randomized','round',[100 400]};</span>
0031 <span class="comment">%  schedule = AddTrial(schedule,vin);</span>
0032 <span class="comment">%</span>
0033 <span class="comment">% OUTPUT: schedule structure with the following fields</span>
0034 <span class="comment">%           trials  ...  unique trials (as cell matrix)</span>
0035 <span class="comment">%           buds    ...  'buddy' parameters</span>
0036 <span class="comment">%</span>
0037 <span class="comment">%      If all data is numeric, then schedule.trials =</span>
0038 <span class="comment">%      CELL2MAT(schedule.trials) can be used.</span>
0039 <span class="comment">%</span>
0040 <span class="comment">%       fail ... true if there was an error during operation, false if all</span>
0041 <span class="comment">%                   is good</span>
0042 <span class="comment">% DJS (c) 2010</span>
0043 
0044 
0045 
0046 <span class="keyword">if</span> iscell(varargin{1})
0047     varargin = varargin{1};
0048     
0049     <span class="comment">% check for randomized option</span>
0050     ind = false(size(varargin));
0051     <span class="keyword">for</span> i = 1:length(varargin)
0052         ind(i) = any(strcmpi(varargin{i},<span class="string">'randomized'</span>));
0053     <span class="keyword">end</span>
0054     <span class="keyword">if</span> any(ind)
0055         <span class="comment">% move randomization to end</span>
0056         t = varargin(ind);
0057         varargin(ind) = [];
0058         varargin(end+1:end+sum(ind)) = t;
0059     <span class="keyword">end</span>
0060     
0061     <span class="keyword">for</span> i = 1:length(varargin)
0062         [schedule,fail] = <a href="#_sub1" class="code" title="subfunction [schedule,fail] = BAT(schedule,varargin)">BAT</a>(schedule,varargin{i});
0063         <span class="keyword">if</span> fail, <span class="keyword">break</span>; <span class="keyword">end</span>
0064     <span class="keyword">end</span>
0065 <span class="keyword">else</span>
0066     [schedule,fail] = <a href="#_sub1" class="code" title="subfunction [schedule,fail] = BAT(schedule,varargin)">BAT</a>(schedule,varargin{1});
0067 <span class="keyword">end</span>
0068 
0069     
0070 
0071 <a name="_sub1" href="#_subfunctions" class="code">function [schedule,fail] = BAT(schedule,varargin)</a>
0072 <span class="keyword">if</span> isempty(schedule) || ~isfield(schedule,<span class="string">'trials'</span>),    schedule.trials = {}; <span class="keyword">end</span>
0073 <span class="keyword">if</span> ~isfield(schedule,<span class="string">'buds'</span>) || ~iscell(schedule.buds), schedule.buds = []; <span class="keyword">end</span>
0074 
0075 <span class="keyword">if</span> iscell(varargin{1})
0076     vin = varargin{1};
0077 <span class="keyword">else</span>
0078     vin = varargin;
0079 <span class="keyword">end</span>
0080 
0081 trials = schedule.trials;
0082 buds   = schedule.buds;
0083 
0084 <span class="keyword">if</span> ischar(vin{1})
0085     <span class="keyword">switch</span> lower(vin{1})
0086         <span class="keyword">case</span> <span class="string">'randomized'</span>
0087             nv = vin{end};
0088             r = nv(1) + abs(diff(nv)) .* rand(size(trials,1),1);
0089             <span class="keyword">if</span> ~isempty(vin{2}) 
0090                 <span class="comment">% optionally apply function such as FIX, ROUND, etc.</span>
0091                 r = feval(vin{2},r);
0092             <span class="keyword">end</span>
0093             trials(:,end+1) = num2cell(r);
0094             
0095         <span class="keyword">case</span> <span class="string">'buddy'</span>
0096             <span class="keyword">if</span> isnumeric(vin{3}) || islogical(vin{3})
0097                 vin{3} = num2cell(vin{3});
0098             <span class="keyword">end</span>
0099             
0100             <span class="keyword">if</span> ~any(strcmp(vin{2},buds))
0101                 buds{end+1} = vin{2};
0102                 [trials,fail] = <a href="#_sub2" class="code" title="subfunction [trials,fail] = combinetrials(trials,newtrials,expand)">combinetrials</a>(trials,vin{3},1);
0103             <span class="keyword">else</span>
0104                 [trials,fail] = <a href="#_sub2" class="code" title="subfunction [trials,fail] = combinetrials(trials,newtrials,expand)">combinetrials</a>(trials,vin{3},0);
0105             <span class="keyword">end</span>
0106     <span class="keyword">end</span>
0107 <span class="keyword">else</span>
0108     <span class="keyword">if</span> isnumeric(vin{1}) || islogical(vin{1})
0109         vin{1} = num2cell(vin{1});
0110     <span class="keyword">end</span>
0111     <span class="keyword">if</span> length(vin) == 1
0112         [trials,fail] = <a href="#_sub2" class="code" title="subfunction [trials,fail] = combinetrials(trials,newtrials,expand)">combinetrials</a>(trials,vin{1},1);
0113     <span class="keyword">else</span>
0114         [trials,fail] = <a href="#_sub2" class="code" title="subfunction [trials,fail] = combinetrials(trials,newtrials,expand)">combinetrials</a>(trials,vin,1);
0115     <span class="keyword">end</span>
0116 <span class="keyword">end</span>
0117 
0118 schedule.trials = trials;
0119 schedule.buds   = buds;
0120 
0121 
0122 <a name="_sub2" href="#_subfunctions" class="code">function [trials,fail] = combinetrials(trials,newtrials,expand)</a>
0123 [i,j] = size(trials);
0124 fail = false;
0125 <span class="keyword">if</span> expand
0126     trials = repmat(trials,length(newtrials),1);
0127     <span class="keyword">if</span> i &gt; 0, newtrials = repmat(newtrials,i,1);    <span class="keyword">end</span>
0128 <span class="keyword">else</span>
0129     <span class="keyword">if</span> rem(i,length(newtrials)) <span class="comment">% results in non-integer value</span>
0130         fail = true;
0131     <span class="keyword">else</span>
0132         newtrials = repmat(newtrials,i/length(newtrials),1);
0133     <span class="keyword">end</span>
0134 <span class="keyword">end</span>
0135 
0136 trials(1:numel(newtrials),j+1) = newtrials(:);
0137 
0138 
0139 
0140 
0141</pre></div>
<hr><address>Generated on Thu 11-Jul-2013 10:16:49 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>