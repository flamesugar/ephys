<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of trialfun_tdt</title>
  <meta name="keywords" content="trialfun_tdt">
  <meta name="description" content="[trl,event] = trialfun_tdt(cfg)">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="../index.html">analysis</a> &gt; <a href="index.html">FT_integration</a> &gt; trialfun_tdt.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for analysis\FT_integration&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>trialfun_tdt
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>[trl,event] = trialfun_tdt(cfg)</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function [trl,event] = trialfun_tdt(cfg) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> [trl,event] = trialfun_tdt(cfg)
 
 Returns trl and event structures for use with FieldTrip

 cfg.tank          ...     registered tank name (or full path to tank)
    .block         ...     scalar integer of a single tank block to process
    .blockroot     ...     root name of the block (eg, 'Block-')
  
    .trialdef.eventtype  ... name of an event (eg, 'BitM'). '?' will get you a list of events
    .trialdef.eventvalue ... value(s) of interest for the event
    .trialdef.prestim    ... onset time (seconds) of window relative to
                             event trigger (value &gt; 0 means before
                             trigger)
    .trialdef.poststim   ... offset time (seconds) of window relative to event trigger
    .trialdef.fsample    ... sampling rate to calculate event and trigger
                             samples

 DJS 2013</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="ft_read_event_tdt.html" class="code" title="function event = ft_read_event_tdt(tank,block,blockroot,eventname,eventvalue,Fs)">ft_read_event_tdt</a>	EVENT = ft_read_event_tdt</li><li><a href="ft_read_event_tdt_2BitM.html" class="code" title="function event = ft_read_event_tdt_2BitM(tank,block,blockroot,eventname,eventvalue,Fs)">ft_read_event_tdt_2BitM</a>	EVENT = ft_read_event_tdt</li></ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [trl,event] = trialfun_tdt(cfg)</a>
0002 <span class="comment">% [trl,event] = trialfun_tdt(cfg)</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% Returns trl and event structures for use with FieldTrip</span>
0005 <span class="comment">%</span>
0006 <span class="comment">% cfg.tank          ...     registered tank name (or full path to tank)</span>
0007 <span class="comment">%    .block         ...     scalar integer of a single tank block to process</span>
0008 <span class="comment">%    .blockroot     ...     root name of the block (eg, 'Block-')</span>
0009 <span class="comment">%</span>
0010 <span class="comment">%    .trialdef.eventtype  ... name of an event (eg, 'BitM'). '?' will get you a list of events</span>
0011 <span class="comment">%    .trialdef.eventvalue ... value(s) of interest for the event</span>
0012 <span class="comment">%    .trialdef.prestim    ... onset time (seconds) of window relative to</span>
0013 <span class="comment">%                             event trigger (value &gt; 0 means before</span>
0014 <span class="comment">%                             trigger)</span>
0015 <span class="comment">%    .trialdef.poststim   ... offset time (seconds) of window relative to event trigger</span>
0016 <span class="comment">%    .trialdef.fsample    ... sampling rate to calculate event and trigger</span>
0017 <span class="comment">%                             samples</span>
0018 <span class="comment">%</span>
0019 <span class="comment">% DJS 2013</span>
0020 
0021 <span class="comment">% check cfg structure</span>
0022 <span class="keyword">if</span> ~isfield(cfg,<span class="string">'tank'</span>),    error(<span class="string">'Missing tank name in cfg'</span>);      <span class="keyword">end</span>
0023 <span class="keyword">if</span> ~isfield(cfg,<span class="string">'blocks'</span>),  error(<span class="string">'Missing blocks number in cfg'</span>);  <span class="keyword">end</span>
0024 <span class="keyword">if</span> ~isfield(cfg,<span class="string">'blockroot'</span>), cfg.blockroot = [];                   <span class="keyword">end</span>
0025 <span class="keyword">if</span> ~isfield(cfg.trialdef,<span class="string">'eventtype'</span>),  cfg.eventtype = [];         <span class="keyword">end</span>
0026 <span class="keyword">if</span> ~isfield(cfg.trialdef,<span class="string">'eventvalue'</span>), cfg.eventvalue = [];        <span class="keyword">end</span>
0027 <span class="keyword">if</span> ~isfield(cfg.trialdef,<span class="string">'prestim'</span>),    cfg.prestim  = 0;           <span class="keyword">end</span>
0028 <span class="keyword">if</span> ~isfield(cfg.trialdef,<span class="string">'poststim'</span>),   cfg.poststim = 1;           <span class="keyword">end</span>
0029 <span class="keyword">if</span> ~isfield(cfg.trialdef,<span class="string">'fsample'</span>),    
0030     error(<span class="string">'trialfun_tdt needs the sampling rate to be specified in cfg.trialdef.fsample'</span>); 
0031 <span class="keyword">end</span>
0032 
0033 Fs = cfg.trialdef.fsample;
0034 
0035 <span class="keyword">if</span> cfg.trialdef.eventtype(1) == <span class="string">'?'</span>
0036     cfg.usemym = false;
0037     cfg.silently = true;
0038     tinfo = getTankData(cfg);
0039     fprintf(<span class="string">'\n\n* Event types and values for tank ''%s'',\n\t\t\tblock ''%s-%d''\n'</span>, <span class="keyword">...</span>
0040         cfg.tank,cfg.blockroot,cfg.blocks)
0041     <span class="keyword">for</span> i = 1:length(tinfo.paramspec)-1
0042         fprintf(<span class="string">'\t''%s'' : %s\n'</span>,tinfo.paramspec{i},mat2str(unique(tinfo.epochs(:,i))))
0043     <span class="keyword">end</span>
0044     fprintf(<span class="string">'\n\n'</span>)
0045     trl   = [];
0046     event = [];
0047     <span class="keyword">return</span>
0048 
0049 
0050 <span class="keyword">else</span>
0051     <span class="keyword">try</span>
0052         <span class="comment">% get event structure</span>
0053         event = <a href="ft_read_event_tdt.html" class="code" title="function event = ft_read_event_tdt(tank,block,blockroot,eventname,eventvalue,Fs)">ft_read_event_tdt</a>(cfg.tank,cfg.blocks,cfg.blockroot, <span class="keyword">...</span>
0054             cfg.trialdef.eventtype,cfg.trialdef.eventvalue,Fs);
0055     <span class="keyword">catch</span> <span class="comment">%#ok&lt;CTCH&gt;</span>
0056         <span class="comment">% Ad hoc solution to convert original event codes to BitM code.  This</span>
0057         <span class="comment">% is a fix for a specific experiment.</span>
0058         fprintf([<span class="string">'\n* There was an error evaluating the default event function ('</span>, <span class="keyword">...</span>
0059             <span class="string">'ft_read_event_tdt).\nCalling a backup ad hoc function (ft_read_event_tdt_2BitM)'</span> ,<span class="keyword">...</span>
0060             <span class="string">'instead *\n'</span>])
0061         event = <a href="ft_read_event_tdt_2BitM.html" class="code" title="function event = ft_read_event_tdt_2BitM(tank,block,blockroot,eventname,eventvalue,Fs)">ft_read_event_tdt_2BitM</a>(cfg.tank,cfg.blocks,cfg.blockroot, <span class="keyword">...</span>
0062             cfg.trialdef.eventtype,cfg.trialdef.eventvalue,Fs);
0063     <span class="keyword">end</span>
0064 <span class="keyword">end</span>
0065 
0066 <span class="comment">% convert prestim and poststim parameters to samples</span>
0067 sprestim  = round(cfg.trialdef.prestim*Fs);
0068 spoststim = round(cfg.trialdef.poststim*Fs);
0069 
0070 esamps = [event.sample];
0071 
0072 <span class="comment">%  The trial definition &quot;trl&quot; is an Nx3 matrix, N is the number of trials.</span>
0073 <span class="comment">%   The first column contains the sample-indices of the begin of each trial</span>
0074 <span class="comment">%   relative to the begin of the raw data, the second column contains the</span>
0075 <span class="comment">%   sample-indices of the end of each trial, and the third column contains</span>
0076 <span class="comment">%   the offset of the trigger with respect to the trial. An offset of 0</span>
0077 <span class="comment">%   means that the first sample of the trial corresponds to the trigger. A</span>
0078 <span class="comment">%   positive offset indicates that the first sample is later than the trigger,</span>
0079 <span class="comment">%   a negative offset indicates that the trial begins before the trigger.</span>
0080 
0081 trl(:,1) = esamps-sprestim;
0082 trl(:,2) = esamps+spoststim-1;
0083 trl(:,3) = -sprestim;
0084 trl(:,4) = [event.value];
0085 
0086 ind = trl(:,1) &lt; 1 | trl(:,1)+trl(:,3) &lt; 1;
0087 <span class="keyword">if</span> any(ind)
0088     warning(<span class="string">'%d of %d trials start before the recording. They were removed'</span>,sum(ind),length(ind))
0089     trl(ind,:) = [];
0090 <span class="keyword">end</span>
0091 
0092 
0093 
0094 
0095 
0096 
0097 
0098</pre></div>
<hr><address>Generated on Wed 24-Jul-2013 19:48:12 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>