<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of AutoClass2</title>
  <meta name="keywords" content="AutoClass2">
  <meta name="description" content="cfg = AutoClass2(W,cfg)">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">spike_sorting</a> &gt; AutoClass2.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for spike_sorting&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>AutoClass2
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>cfg = AutoClass2(W,cfg)</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>function cfg = AutoClass2(W,cfg) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"> cfg = AutoClass2(W,cfg)
 
 Runs AutoClass Bayesian classifier (NASA) on spike waveforms.  Spike
 waveforms should be prealigned.

 W is a matrix of #samples X #waveforms
 
 CFG is a structure with atleast the following fields:
   .tank
   .AutoClass.resultsdir
   .AutoClass.fileroot
   .AutoClass.varFactor (default = 2)
 
 NOTE: cfg.AutoClass.fileroot should be a unique name, possibly including
 tank name and channel number.


 DJS 2011</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
<li><a href="RunAutoClass.html" class="code" title="function TANKS = RunAutoClass(TANKS)">RunAutoClass</a>	RunAutoClass</li><li><a href="SCRATCH_AutoClass2.html" class="code" title="">SCRATCH_AutoClass2</a>	% AutoClass Scratch</li></ul>
<!-- crossreference -->



<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function cfg = AutoClass2(W,cfg)</a>
0002 <span class="comment">% cfg = AutoClass2(W,cfg)</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% Runs AutoClass Bayesian classifier (NASA) on spike waveforms.  Spike</span>
0005 <span class="comment">% waveforms should be prealigned.</span>
0006 <span class="comment">%</span>
0007 <span class="comment">% W is a matrix of #samples X #waveforms</span>
0008 <span class="comment">%</span>
0009 <span class="comment">% CFG is a structure with atleast the following fields:</span>
0010 <span class="comment">%   .tank</span>
0011 <span class="comment">%   .AutoClass.resultsdir</span>
0012 <span class="comment">%   .AutoClass.fileroot</span>
0013 <span class="comment">%   .AutoClass.varFactor (default = 2)</span>
0014 <span class="comment">%</span>
0015 <span class="comment">% NOTE: cfg.AutoClass.fileroot should be a unique name, possibly including</span>
0016 <span class="comment">% tank name and channel number.</span>
0017 <span class="comment">%</span>
0018 <span class="comment">%</span>
0019 <span class="comment">% DJS 2011</span>
0020 
0021 AC = cfg.AutoClass;
0022 
0023 <span class="keyword">if</span> ~isfield(AC,<span class="string">'varFactor'</span>) || isempty(AC.varFactor), AC.varFactor = 2; <span class="keyword">end</span>
0024 
0025 <span class="keyword">if</span> ~isdir(AC.resultsdir), mkdir(AC.resultsdir); <span class="keyword">end</span>
0026 
0027 <span class="comment">% CREATE FILE NAMES</span>
0028 <span class="keyword">if</span> AC.resultsdir(end) ~= <span class="string">'\'</span>, AC.resultsdir(end+1) = <span class="string">'\'</span>; <span class="keyword">end</span>
0029 t = [AC.resultsdir AC.fileroot];
0030 AC.snipsfn =     [t <span class="string">'_SNIP.mat'</span>]; <span class="comment">% spike data</span>
0031 AC.hd2 =         [t <span class="string">'.hd2'</span>]; <span class="comment">% header file</span>
0032 AC.db2 =         [t <span class="string">'.db2'</span>]; <span class="comment">% data file</span>
0033 AC.model =       [t <span class="string">'.model'</span>]; <span class="comment">% model file (standard)</span>
0034 AC.s_params =    [t <span class="string">'.s-params'</span>]; <span class="comment">% s-params file (standard)</span>
0035 AC.r_params =    [t <span class="string">'.r-params'</span>]; <span class="comment">% r-params file (standard)</span>
0036 AC.results_bin = [t <span class="string">'.results-bin'</span>]; <span class="comment">% results-bin file (reporting)</span>
0037 AC.search =      [t <span class="string">'.search'</span>]; <span class="comment">% search file (used by AutoClass.exe)</span>
0038 AC.case_data_1 = [t <span class="string">'.case-data-1'</span>]; <span class="comment">% case-data-1 file (used by AutoClass.exe)</span>
0039 <span class="comment">% AC.exelocale = [matlabroot '\work\Electrophys\MultiChannel Analysis\AutoClass\']; % AutoClass.exe location</span>
0040 <span class="comment">% AC.exelocale = 'C:\MATLAB\work\Electrophys\MultiChannel Analysis\AutoClass\';</span>
0041 
0042 AC.exelocale = getpref(<span class="string">'AutoClass'</span>,<span class="string">'exelocale'</span>,[]);
0043 <span class="keyword">if</span> isempty(AC.exelocale)
0044     AC.exelocale = uigetdir(matlabroot,<span class="string">'Locate Directory with AutoClass.exe'</span>);
0045     <span class="keyword">if</span> isempty(AC.exelocale)
0046         error(<span class="string">'AutoClass2: need AutoClass directory!'</span>)
0047     <span class="keyword">end</span>
0048     setpref(<span class="string">'AutoClass'</span>,<span class="string">'exelocale'</span>,AC.exelocale)
0049 <span class="keyword">end</span>
0050 <span class="keyword">if</span> AC.exelocale(end) ~= <span class="string">'\'</span>, AC.exelocale(end+1) = <span class="string">'\'</span>; <span class="keyword">end</span>
0051 
0052 
0053 <span class="comment">%CALCULATE VARIANCE OF DATA</span>
0054 AC.meanWaveform = mean(W);
0055 <span class="comment">% AC.MeasError = (1/2^16)/2; % 16-bit A/D divided by 2</span>
0056 AC.MeasError = 0.0;
0057 AC.varData   = var(W);
0058 AC.varThresh = AC.varData * AC.varFactor;
0059 
0060 <span class="comment">% find samples greater than variance threshold</span>
0061 <span class="comment">% AC.varSamples = find(AC.varData &gt;= AC.meanWaveform + AC.varThresh);</span>
0062 AC.varSamples = 1:length(AC.varData); <span class="comment">% using all samples of the waveform seems to work best</span>
0063 
0064 cfg.AutoClass = AC;
0065 
0066 <span class="comment">%SAVE DATA FOR AUTOCLASS</span>
0067 fprintf(<span class="string">'\t&gt; Saving data for AutoClass\n'</span>)  
0068 save(AC.snipsfn,<span class="string">'W'</span>,<span class="string">'cfg'</span>);
0069 dlmwrite(AC.db2,W(:,AC.varSamples),<span class="string">','</span>);
0070 
0071 <span class="comment">% hd2 file</span>
0072 fid = fopen(AC.hd2,<span class="string">'wt'</span>);
0073 fprintf(fid,<span class="string">'!#; AutoClass C header file -- extension .hd2\n'</span>);
0074 fprintf(fid,<span class="string">'!#; the following chars in column 1 make the line a comment:\n'</span>);
0075 fprintf(fid,<span class="string">'!#; ''!'', ''#'', '';'', '' '', and ''\\n'' (empty line)\n'</span>);
0076 fprintf(fid,<span class="string">'  \n'</span>);
0077 fprintf(fid,<span class="string">';#! num_db2_format_defs &lt;num of def lines -- min 1, max 4&gt;\n'</span>);
0078 fprintf(fid,<span class="string">'num_db2_format_defs 2\n'</span>);
0079 fprintf(fid,<span class="string">';; required\n'</span>);
0080 fprintf(fid,<span class="string">'number_of_attributes %1.0f\n'</span>,length(AC.varSamples));
0081 fprintf(fid,<span class="string">';; optional - default values are specified \n'</span>);
0082 fprintf(fid,<span class="string">';; separator_char  '' ''\n'</span>);
0083 fprintf(fid,<span class="string">';; comment_char    '';''\n'</span>);
0084 fprintf(fid,<span class="string">';; unknown_token   ''?''\n'</span>);
0085 fprintf(fid,<span class="string">'separator_char     '',''\n'</span>);
0086 fprintf(fid,<span class="string">' \n'</span> );
0087 fprintf(fid,<span class="string">';; &lt;zero-based att#&gt;  &lt;att_type&gt;  &lt;att_sub_type&gt;  &lt;att_description&gt;  &lt;att_param_pairs&gt;\n'</span>);
0088 
0089 fm(1,:) = 0:length(AC.varSamples)-1;
0090 fm(2,:) = AC.varSamples;
0091 fm(3,:) = AC.MeasError;
0092 
0093 fprintf(fid,<span class="string">'%1.0f real location &quot;SNIP%1.0f&quot; error %0.6f \n'</span>,fm);
0094 fclose(fid);
0095 
0096 <span class="comment">% Ensure Autoclass has all the right files to run</span>
0097 copyfile([AC.exelocale <span class="string">'SNIP.model'</span>],   AC.model);
0098 copyfile([AC.exelocale <span class="string">'SNIP.s-params'</span>],AC.s_params);
0099 copyfile([AC.exelocale <span class="string">'SNIP.r-params'</span>],AC.r_params);
0100 
0101 dosSTR = sprintf(<span class="string">'Autoclass.exe -search &quot;%s&quot; &quot;%s&quot; &quot;%s&quot; &quot;%s&quot; &amp;'</span>, <span class="keyword">...</span>
0102     AC.hd2,AC.db2,AC.model,AC.s_params);
0103 
0104 fprintf(<span class="string">'\t&gt; Launching AutoClass\n'</span>)
0105 [~,~] = dos(dosSTR);
0106 
0107 cfg.dosSTR = dosSTR;
0108 
0109 <span class="comment">% Usage: psexec [\\computer[,computer2[,...] | @file][-u user [-p psswd]]</span>
0110 <span class="comment">% [-n s][-l][-s|-e][-x][-i [session]][-c [-f|-v]][-w directory][-d]</span>
0111 <span class="comment">% [-&lt;priority&gt;][-a n,n,... ] cmd [arguments]</span>
0112 <span class="comment">% computer:    Direct PsExec to run the application on the computer or</span>
0113 <span class="comment">% computers specified. If you omit the computer name PsExec runs the</span>
0114 <span class="comment">% application on the local system and if you enter a computer name of &quot;\\*&quot;</span>
0115 <span class="comment">% PsExec runs the applications on all computers in the current domain.</span>
0116 <span class="comment">% See http://technet.microsoft.com/en-us/sysinternals/bb897553</span>
0117</pre></div>
<hr><address>Generated on Thu 11-Jul-2013 10:16:49 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>