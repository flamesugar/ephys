<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of DB_NewSubjPrompt</title>
  <meta name="keywords" content="DB_NewSubjPrompt">
  <meta name="description" content="h = DB_NewSubjPrompt">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../index.html">Home</a> &gt;  <a href="#">db</a> &gt; <a href="index.html">gui</a> &gt; DB_NewSubjPrompt.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../index.html"><img alt="<" border="0" src="../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for db\gui&nbsp;<img alt=">" border="0" src="../../right.png"></a></td></tr></table>-->

<h1>DB_NewSubjPrompt
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>h = DB_NewSubjPrompt</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="box"><strong>function varargout = DB_NewSubjPrompt(varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> h = DB_NewSubjPrompt
 h = DB_NewSubjPrompt(database)
 
 Create New Database Subject.  If database name is not supplied as input
 then a list dialog will prompt the user to select a database.
 
 DJS (c) 2010
 
 Last Modified by GUIDE v2.5 10-May-2013 13:10:04</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="DB_UploadUtility.html" class="code" title="function varargout = DB_UploadUtility(varargin)">DB_UploadUtility</a>	Last Modified by GUIDE v2.5 29-May-2013 09:40:19</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<ul style="list-style-image:url(../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function DB_NewSubjPrompt_OpeningFcn(hObject, ~, handles, varargin)</a></li><li><a href="#_sub2" class="code">function varargout = DB_NewSubjPrompt_OutputFcn(hObject, ~, handles)</a></li><li><a href="#_sub3" class="code">function add_subject_Callback(~, ~, handles)</a></li><li><a href="#_sub4" class="code">function cancel_Callback(~, ~, handles)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function varargout = DB_NewSubjPrompt(varargin)</a>
0002 <span class="comment">% h = DB_NewSubjPrompt</span>
0003 <span class="comment">% h = DB_NewSubjPrompt(database)</span>
0004 <span class="comment">%</span>
0005 <span class="comment">% Create New Database Subject.  If database name is not supplied as input</span>
0006 <span class="comment">% then a list dialog will prompt the user to select a database.</span>
0007 <span class="comment">%</span>
0008 <span class="comment">% DJS (c) 2010</span>
0009 <span class="comment">%</span>
0010 <span class="comment">% Last Modified by GUIDE v2.5 10-May-2013 13:10:04</span>
0011 
0012 <span class="comment">% Begin initialization code - DO NOT EDIT</span>
0013 gui_Singleton = 1;
0014 gui_State = struct(<span class="string">'gui_Name'</span>,       mfilename, <span class="keyword">...</span>
0015                    <span class="string">'gui_Singleton'</span>,  gui_Singleton, <span class="keyword">...</span>
0016                    <span class="string">'gui_OpeningFcn'</span>, @<a href="#_sub1" class="code" title="subfunction DB_NewSubjPrompt_OpeningFcn(hObject, ~, handles, varargin)">DB_NewSubjPrompt_OpeningFcn</a>, <span class="keyword">...</span>
0017                    <span class="string">'gui_OutputFcn'</span>,  @<a href="#_sub2" class="code" title="subfunction varargout = DB_NewSubjPrompt_OutputFcn(hObject, ~, handles)">DB_NewSubjPrompt_OutputFcn</a>, <span class="keyword">...</span>
0018                    <span class="string">'gui_LayoutFcn'</span>,  [] , <span class="keyword">...</span>
0019                    <span class="string">'gui_Callback'</span>,   []);
0020 <span class="keyword">if</span> nargin &amp;&amp; ischar(varargin{1})
0021     gui_State.gui_Callback = str2func(varargin{1});
0022 <span class="keyword">end</span>
0023 
0024 <span class="keyword">if</span> nargout
0025     [varargout{1:nargout}] = gui_mainfcn(gui_State, varargin{:});
0026 <span class="keyword">else</span>
0027     gui_mainfcn(gui_State, varargin{:});
0028 <span class="keyword">end</span>
0029 <span class="comment">% End initialization code - DO NOT EDIT</span>
0030 
0031 
0032 <span class="comment">% --- Executes just before DB_NewSubjPrompt is made visible.</span>
0033 <a name="_sub1" href="#_subfunctions" class="code">function DB_NewSubjPrompt_OpeningFcn(hObject, ~, handles, varargin)</a>
0034 database = [];
0035 <span class="keyword">if</span> length(varargin) == 1
0036     database = varargin{1};
0037 <span class="keyword">end</span>
0038 
0039 <span class="keyword">if</span> isempty(database)
0040     dbs = DB_Connect;
0041     [sel,ok] = listdlg( <span class="keyword">...</span>
0042         <span class="string">'ListString'</span>,dbs, <span class="keyword">...</span>
0043         <span class="string">'PromptString'</span>,<span class="string">'Select Database to add subject:'</span>, <span class="keyword">...</span>
0044         <span class="string">'Name'</span>,<span class="string">'Select Database'</span>, <span class="keyword">...</span>
0045         <span class="string">'SelectionMode'</span>,<span class="string">'single'</span>, <span class="keyword">...</span>
0046         <span class="string">'OKString'</span>,<span class="string">'Select'</span>);
0047     <span class="keyword">if</span> ok
0048         database = dbs{sel};
0049     <span class="keyword">end</span>
0050 <span class="keyword">else</span>
0051     ok = 1;
0052 <span class="keyword">end</span>
0053 
0054 <span class="keyword">if</span> ok
0055     setappdata(hObject,<span class="string">'database'</span>,database);
0056 <span class="keyword">end</span>
0057 
0058 
0059 handles.killfig = ~ok;
0060 
0061 <span class="comment">% Choose default command line output for DB_NewSubjPrompt</span>
0062 handles.output = hObject;
0063 
0064 <span class="comment">% Update handles structure</span>
0065 guidata(hObject, handles);
0066 
0067 
0068 
0069 <span class="comment">% --- Outputs from this function are returned to the command line.</span>
0070 <a name="_sub2" href="#_subfunctions" class="code">function varargout = DB_NewSubjPrompt_OutputFcn(hObject, ~, handles) </a>
0071 
0072 <span class="comment">% Get default command line output from handles structure</span>
0073 varargout{1} = handles.output;
0074 
0075 <span class="keyword">if</span> handles.killfig
0076     close(hObject);
0077 <span class="keyword">else</span>
0078     db = getappdata(hObject,<span class="string">'database'</span>);
0079     set(hObject,<span class="string">'Name'</span>,db);
0080 <span class="keyword">end</span>
0081 
0082 
0083 <a name="_sub3" href="#_subfunctions" class="code">function add_subject_Callback(~, ~, handles) </a><span class="comment">%#ok&lt;DEFNU&gt;</span>
0084 n  = get(handles.name,<span class="string">'String'</span>);
0085 sp = cellstr(get(handles.species,<span class="string">'String'</span>));
0086 sp = lower(sp{get(handles.species,<span class="string">'Value'</span>)});
0087 st = get(handles.strain,<span class="string">'String'</span>);
0088 d  = datestr(get(handles.dob,<span class="string">'String'</span>),<span class="string">'yyyy-mm-dd'</span>);
0089 w  = get(handles.weight,<span class="string">'String'</span>);
0090 sx = cellstr(get(handles.sex,<span class="string">'String'</span>));
0091 sx = sx{get(handles.sex,<span class="string">'Value'</span>)};
0092 sx(2:end) = [];
0093 sn = get(handles.notes,<span class="string">'String'</span>); <span class="keyword">if</span> isempty(sn), sn = <span class="string">' '</span>; <span class="keyword">end</span>
0094 
0095 database = getappdata(handles.figure1,<span class="string">'database'</span>);
0096 
0097 id = myms(sprintf([<span class="string">'SELECT id FROM %s.subjects '</span>, <span class="keyword">...</span>
0098           <span class="string">'WHERE name = &quot;%s&quot;'</span>],database,n));
0099       
0100 <span class="keyword">if</span> ~isempty(id)
0101     warndlg(sprintf(<span class="string">'Subject ''%s'' already exists in database (id# %d)'</span>,n,id), <span class="keyword">...</span>
0102         <span class="string">'Subject Exists'</span>,<span class="string">'modal'</span>);
0103     <span class="keyword">return</span>
0104 <span class="keyword">end</span>
0105 
0106 mym([ <span class="keyword">...</span>
0107     <span class="string">'INSERT INTO {S}.subjects '</span>, <span class="keyword">...</span>
0108     <span class="string">'(name, species, strain, dob, weight, sex, subject_notes) '</span>, <span class="keyword">...</span>
0109     <span class="string">'VALUES '</span>, <span class="keyword">...</span>
0110     <span class="string">'(&quot;{S}&quot;,&quot;{S}&quot;,&quot;{S}&quot;,&quot;{S}&quot;,{S},&quot;{S}&quot;,&quot;{S}&quot;)'</span>], <span class="keyword">...</span>
0111     database,n,sp,st,d,w,sx,sn);
0112 
0113 id = myms(sprintf([<span class="string">'SELECT id FROM %s.subjects '</span>, <span class="keyword">...</span>
0114           <span class="string">'WHERE name = &quot;%s&quot;'</span>],database,n));
0115 <span class="keyword">if</span> isempty(id)
0116     warndlg(sprintf(<span class="string">'Subject ''%s'' was not added to database correctly!'</span>,n), <span class="keyword">...</span>
0117         <span class="string">'Error'</span>,<span class="string">'modal'</span>);
0118 <span class="keyword">else</span>
0119 <span class="comment">%     helpdlg(sprintf('Subject ''%s'' was added to the database.',n), ...</span>
0120 <span class="comment">%         'Success');</span>
0121     
0122     fprintf(<span class="string">'Subject ''%s'' was added to the database.\n'</span>,n)
0123     close(handles.figure1)
0124     drawnow
0125 <span class="keyword">end</span>
0126 
0127 
0128 
0129 <a name="_sub4" href="#_subfunctions" class="code">function cancel_Callback(~, ~, handles) </a><span class="comment">%#ok&lt;DEFNU&gt;</span>
0130 close(handles.figure1);</pre></div>
<hr><address>Generated on Thu 11-Jul-2013 10:16:49 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>